import{j as e}from"./radix-ui-core-CVbt7vjv.js";import{c as f}from"./react-vendor-CF8XAmli.js";import{s as b}from"./index-SAJX4igD.js";import{al as y,X as j,au as w,av as v,t as p}from"./other-ui-8Y7Mtx8D.js";const N={uploadImage:async(r,t="images",l="about")=>{if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(r.type))throw new Error(`Invalid file type: ${r.type}. Allowed types: JPG, PNG, WebP, GIF`);const n=r.name.split(".").pop()?.toLowerCase(),d=`${l}/${Date.now()}-${Math.random().toString(36).substring(7)}.${n}`,{data:u,error:s}=await b.storage.from(t).upload(d,r,{cacheControl:"3600",upsert:!1,contentType:r.type});if(s)throw console.error("Upload error:",s),new Error(`Upload failed: ${s.message}`);const{data:{publicUrl:i}}=b.storage.from(t).getPublicUrl(d);return{path:u.path,url:i}},deleteImage:async(r,t="images")=>{const{error:l}=await b.storage.from(t).remove([r]);if(l)throw l}};function E({value:r,onChange:t,label:l,description:g}){const[n,d]=f.useState(!1),[u,s]=f.useState(r),i=f.useRef(null),x=async m=>{const c=m.target.files?.[0];if(c){if(!c.type.startsWith("image/")){p.error("File harus berupa gambar");return}if(c.size>5*1024*1024){p.error("Ukuran file maksimal 5MB");return}try{d(!0);const a=new FileReader;a.onloadend=()=>{s(a.result)},a.readAsDataURL(c);const{url:o}=await N.uploadImage(c,"images","about");t(o),s(o),p.success("Gambar berhasil diupload")}catch(a){console.error("Upload error:",a);let o="Gagal mengupload gambar";a.message&&(a.message.includes("406")?o="Error 406: Bucket storage belum dikonfigurasi dengan benar. Periksa SUPABASE_STORAGE_SETUP.md":a.message.includes("Invalid file type")?o=a.message:a.message.includes("not configured")?o="Supabase belum dikonfigurasi":o=`Upload gagal: ${a.message}`),p.error(o,{duration:5e3,description:"Periksa console browser (F12) untuk detail error"}),s(r)}finally{d(!1),i.current&&(i.current.value="")}}},h=()=>{s(""),t("")};return e.jsxs("div",{className:"space-y-3",children:[l&&e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:l})]}),e.jsxs("div",{className:"flex gap-4 items-start",children:[u&&e.jsxs("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden border border-border flex-shrink-0 group",children:[e.jsx("img",{src:u,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:h,className:"absolute top-2 right-2 p-1 bg-destructive text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(j,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:x,className:"hidden",disabled:n}),e.jsx("button",{type:"button",onClick:()=>i.current?.click(),disabled:n,className:"w-full px-4 py-3 border-2 border-dashed border-border rounded-xl hover:border-primary hover:bg-primary/5 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Mengupload..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-5 w-5"}),e.jsx("span",{children:"Upload Gambar"})]})}),g&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:g})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Atau masukkan URL gambar:"}),e.jsx("input",{type:"url",value:r,onChange:m=>{t(m.target.value),s(m.target.value)},placeholder:"https://...",className:"w-full px-4 py-2 bg-background border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary text-sm"})]})]})}export{E as I};
