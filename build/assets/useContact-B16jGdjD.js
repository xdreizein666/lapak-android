import{c as u}from"./react-vendor-CF8XAmli.js";import{s as i,i as y}from"./index-SAJX4igD.js";const d={async getAll(a){let e=i.from("contact_messages").select("*").order("created_at",{ascending:!1});a?.status&&(e=e.eq("status",a.status));const{data:t,error:n}=await e;if(n)throw n;return t},async create(a){const{data:e,error:t}=await i.from("contact_messages").insert([{...a,status:"new"}]).select().maybeSingle();if(t)throw t;if(!e)throw new Error("Failed to create message (check RLS policies)");return e},async updateStatus(a,e){const{data:t,error:n}=await i.from("contact_messages").update({status:e}).eq("id",a).select().maybeSingle();if(n)throw n;if(!t)throw new Error("Message not found or permission denied (check RLS policies)");return t},async delete(a){const{error:e}=await i.from("contact_messages").delete().eq("id",a);if(e)throw e},async getUnreadCount(){const{count:a,error:e}=await i.from("contact_messages").select("*",{count:"exact",head:!0}).eq("status","new");if(e)throw e;return a||0}},S=[{id:"1",name:"John Doe",email:"john@example.com",phone:"+62 812-3456-7890",brand:"Xiaomi",message:"Saya ingin root Xiaomi Redmi Note 12 Pro saya. Berapa biayanya?",status:"new",created_at:new Date().toISOString()},{id:"2",name:"Jane Smith",email:"jane@example.com",phone:"+62 813-4567-8901",brand:"Samsung",message:"Apakah ada garansi jika unlock bootloader gagal?",status:"read",created_at:new Date(Date.now()-864e5).toISOString()}];function q(a={}){const[e,t]=u.useState([]),[n,g]=u.useState(!0),[h,c]=u.useState(null),{status:l,autoFetch:m=!0}=a,f=async()=>{try{g(!0),c(null);const s=await d.getAll({status:l});t(s)}catch(s){c(s),console.error("Error fetching contact messages:",s),t(S)}finally{g(!1)}};return u.useEffect(()=>{m&&f()},[l,m]),{messages:e,loading:n,error:h,refetch:f,createMessage:async s=>{try{const r=await d.create(s);return t(o=>[r,...o]),r}catch(r){throw c(r),r}},updateMessageStatus:async(s,r)=>{try{const o=await d.updateStatus(s,r);return t(p=>p.map(w=>w.id===s?o:w)),o}catch(o){throw c(o),o}},deleteMessage:async s=>{try{await d.delete(s),t(r=>r.filter(o=>o.id!==s))}catch(r){throw c(r),r}}}}export{q as u};
