import{c as d}from"./react-vendor-CF8XAmli.js";import{s as n,i as S}from"./index-B7e89noG.js";const u={async getAll(e){let t=n.from("projects").select("*").order("created_at",{ascending:!1});e?.brand&&(t=t.eq("brand",e.brand)),e?.category&&(t=t.eq("category",e.category)),e?.status&&(t=t.eq("status",e.status));const{data:r,error:c}=await t;if(c)throw c;return r},async getById(e){const{data:t,error:r}=await n.from("projects").select("*").eq("id",e).maybeSingle();if(r)throw r;if(!t)throw new Error("Project not found");return t},async create(e){const{data:t,error:r}=await n.from("projects").insert([e]).select().maybeSingle();if(r)throw r;if(!t)throw new Error("Failed to create project (check RLS policies)");return t},async update(e,t){const{data:r,error:c}=await n.from("projects").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().maybeSingle();if(c)throw c;if(!r)throw new Error("Project not found or permission denied (check RLS policies)");return r},async delete(e){const{error:t}=await n.from("projects").delete().eq("id",e);if(t)throw t},async incrementViews(e){const{error:t}=await n.rpc("increment_project_views",{project_id:e});if(t)throw t},async getTotalViews(){const{data:e,error:t}=await n.from("projects").select("views");if(t)throw t;return e.reduce((r,c)=>r+(c.views||0),0)}},P=[{id:"1",title:"Root Xiaomi Redmi Note 12 Pro",brand:"Xiaomi",category:"Root Android",description:"Root lengkap dengan Magisk terbaru, unlock bootloader, dan instalasi custom recovery TWRP",image_url:"https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=800",status:"completed",views:245,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"2",title:"Custom ROM Samsung Galaxy A54",brand:"Samsung",category:"Custom ROM",description:"Instalasi Pixel Experience ROM terbaru dengan GApps dan optimasi performa maksimal",image_url:"https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=800",status:"completed",views:189,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];function k(e={}){const[t,r]=d.useState([]),[c,p]=d.useState(!0),[y,i]=d.useState(null),{brand:l,category:w,status:m,autoFetch:f=!0}=e,g=async()=>{try{p(!0),i(null);const a=await u.getAll({brand:l,category:w,status:m});r(a)}catch(a){i(a),console.error("Error fetching projects:",a),r(P)}finally{p(!1)}};return d.useEffect(()=>{f&&g()},[l,w,m,f]),{projects:t,loading:c,error:y,refetch:g,createProject:async a=>{try{const o=await u.create(a);return r(s=>[o,...s]),o}catch(o){throw i(o),o}},updateProject:async(a,o)=>{try{const s=await u.update(a,o);return r(j=>j.map(h=>h.id===a?s:h)),s}catch(s){throw i(s),s}},deleteProject:async a=>{try{await u.delete(a),r(o=>o.filter(s=>s.id!==a))}catch(o){throw i(o),o}}}}export{k as u};
